## managed by salt - do not edit!

{% set roles = salt['grains.get']('roles', []) %}

{% macro var_if_pillar(name, deflt) %}
{%- set val = salt['pillar.get']('mirrorcache:' + name, deflt) -%}
    {%- if ( val ) -%}
MIRRORCACHE_{{ name.upper() }}={{ val }}
    {%- endif -%}
{% endmacro %}

{{ var_if_pillar('root',     'http://download.opensuse.org') }}
{{ var_if_pillar('root_nfs', '') }}

# TODO salt GeoIP
{%- if salt['file.file_exists']('/var/lib/GeoIP/GeoLite2-City.mmdb') -%}
MIRRORCACHE_CITY_MMDB=/var/lib/GeoIP/GeoLite2-City.mmdb
{%- endif %}

MIRRORCACHE_DB_PROVIDER=mariadb
MIRRORCACHE_DBHOST={{ salt['pillar.get']('mirrorcache:db:host', '') }}
MIRRORCACHE_DBUSER=mirrorcache
MIRRORCACHE_DBPASS={{ salt['pillar.get']('mysql:user:mirrorcache:password', '') }}

{% if 'mirrorcache-webui' in roles -%}
MIRRORCACHE_TOP_FOLDERS="debug distribution factory history ports repositories source tumbleweed update"
MIRRORCACHE_BRANDING=openSUSE
MIRRORCACHE_MATALINK_GREEDY=3
MOJO_LISTEN=http://*:3000
MOJO_REVERSE_PROXY=1
{{ var_if_pillar('redirect',          '') }}
{{ var_if_pillar('redirect_huge',     '') }}
{{ var_if_pillar('workers',           '') }}
{{ var_if_pillar('proxy_url',         '') }}
{{ var_if_pillar('stat_flush_count',  300) }}
{%- endif -%}

{%- if 'mirrorcache-backstage' in roles -%}
{{ var_if_pillar('hashes_import',     '') }}
{{ var_if_pillar('hashes_collect',    '') }}
{{ var_if_pillar('backstage_workers', '') }}
{{ var_if_pillar('zsync_collect',     'xml.gz') }}
{%- endif %}

MOJO_PUBSUB_EXPERIMENTAL=1
