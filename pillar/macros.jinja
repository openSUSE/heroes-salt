{%- macro valid_virt_cluster() -%}
  {%- import_yaml "valid_custom_grains.yaml" as valid_custom_grains -%}
  {%- set valid_virt_cluster = [] -%}
  {%- for country, data in valid_custom_grains['localized'].items() -%}
    {%- if data['virt_cluster'] is iterable and data['virt_cluster'] is not string -%}
      {%- for item in data['virt_cluster'] -%}
        {%- do valid_virt_cluster.append(item) -%}
      {%- endfor -%}
    {%- else -%}
      {%- do valid_virt_cluster.append(data['virt_cluster']) -%}
    {%- endif -%}
  {%- endfor -%}
  {{ valid_virt_cluster }}
{%- endmacro -%}

{%- macro bond(name, slave0, slave1) -%}
    bond-{{ name }}:
      usercontrol: false
      bonding_master: true
      bonding_module_opts: mode=802.3ad miimon=100 lacp_rate=fast
      bonding_slave0: {{ slave0 }}
      bonding_slave1: {{ slave1 }}
      firewall: false
{%- endmacro -%}

{%- macro slave(name) -%}
    {{ name }}:
      bootproto: none
      firewall: false
{%- endmacro -%}

{%- macro vlantap(name, vlan_id, device) -%}
    x-{{ name }}:
      bootproto: none
      vlan_id: {{ vlan_id }}
      etherdevice: {{ device }}
      zone: drop
{%- endmacro -%}
